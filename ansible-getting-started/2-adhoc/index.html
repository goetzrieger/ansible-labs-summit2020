<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.75.1" />
    <meta name="description" content="Ansible and Ansible Tower Labs">
<meta name="author" content="Christian, Eric, Götz, Ismail, Joachim">

    <link rel="icon" href="https://goetzrieger.github.io/images/favicon.png" type="image/png">

    <title>Running ad hoc commands :: Ansible Labs for AnsibleFest</title>

    
    <link href="https://goetzrieger.github.io/css/nucleus.css?1601306300" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/fontawesome-all.min.css?1601306300" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/hybrid.css?1601306300" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/featherlight.min.css?1601306300" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/perfect-scrollbar.min.css?1601306300" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/auto-complete.css?1601306300" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/atom-one-dark-reasonable.css?1601306300" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/theme.css?1601306300" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/hugo-theme.css?1601306300" rel="stylesheet">
    
      <link href="https://goetzrieger.github.io/css/theme-red.css?1601306300" rel="stylesheet">
    

    <script src="https://goetzrieger.github.io/js/jquery-3.3.1.min.js?1601306300"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="https://goetzrieger.github.io/ansible-getting-started/2-adhoc/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://goetzrieger.github.io/">
  <img src="https://goetzrieger.github.io/images/email_ansiblefest-2020.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://goetzrieger.github.io/js/lunr.min.js?1601306300"></script>
<script type="text/javascript" src="https://goetzrieger.github.io/js/auto-complete.js?1601306300"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/goetzrieger.github.io\/";
    
</script>
<script type="text/javascript" src="https://goetzrieger.github.io/js/search.js?1601306300"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/ansible-getting-started/" title="Ansible Getting Started" class="dd-item 
        parent
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/">
          Ansible Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/ansible-getting-started/1-setup/" title="Check the Prerequisites" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/1-setup/">
          Check the Prerequisites
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-getting-started/2-adhoc/" title="Running ad hoc commands" class="dd-item 
        parent
        active
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/2-adhoc/">
          Running ad hoc commands
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-getting-started/3-playbook/" title="Writing Your First Playbook" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/3-playbook/">
          Writing Your First Playbook
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-getting-started/4-variables/" title="Using Variables" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/4-variables/">
          Using Variables
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-getting-started/5-handlers/" title="Conditionals, Handlers and Loops" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/5-handlers/">
          Conditionals, Handlers and Loops
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-getting-started/6-templates/" title="Templates" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/6-templates/">
          Templates
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-getting-started/7-bonus/" title="Bonus Labs" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/7-bonus/">
          Bonus Labs
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/ansible-tower-getting-started/" title="Ansible Tower Getting Started" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/">
          Ansible Tower Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-getting-started/1-intro/" title="Introduction to Tower" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/1-intro/">
          Introduction to Tower
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-getting-started/2-cred/" title="Inventories, credentials and ad hoc commands" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/2-cred/">
          Inventories, credentials and ad hoc commands
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-getting-started/3-projects/" title="Projects &amp; job templates" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/3-projects/">
          Projects &amp; job templates
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-getting-started/4-surveys/" title="Surveys" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/4-surveys/">
          Surveys
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-getting-started/5-rbac/" title="Role-based access control" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/5-rbac/">
          Role-based access control
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-getting-started/6-workflows/" title="Workflows" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/6-workflows/">
          Workflows
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-getting-started/7-wrap/" title="Wrap up" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/7-wrap/">
          Wrap up
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/ansible-tower-advanced/" title="Ansible Tower Advanced" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/">
          Ansible Tower Advanced
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/1-intro/" title="Ansible Tower Advanced" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/1-intro/">
          Ansible Tower Advanced
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/2-clustering/" title="Introduction to Ansible Tower Clustering" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/2-clustering/">
          Introduction to Ansible Tower Clustering
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/3-awx-cli-intro/" title="There is more to Tower than the Web UI" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/3-awx-cli-intro/">
          There is more to Tower than the Web UI
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/4-awx-cli-exercises/" title="Creating Tower Objects Using `awx`" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/4-awx-cli-exercises/">
          Creating Tower Objects Using `awx`
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/5-tower-cluster-jobs/" title="Run a Job in a Cluster" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/5-tower-cluster-jobs/">
          Run a Job in a Cluster
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/6-instance-groups/" title="Tower Instance Groups" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/6-instance-groups/">
          Tower Instance Groups
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/7-parallel-jobs/" title="Parallel Jobs" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/7-parallel-jobs/">
          Parallel Jobs
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/8-isolated-nodes/" title="Isolated Nodes" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/8-isolated-nodes/">
          Isolated Nodes
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/9-advanced-inventories/" title="Advanced Inventories" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/9-advanced-inventories/">
          Advanced Inventories
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/10-structured-content/" title="Well Structured Content Repositories" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/10-structured-content/">
          Well Structured Content Repositories
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/ansible-tower-advanced/11-rest-api/" title="Discovering the Tower API" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/11-rest-api/">
          Discovering the Tower API
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/vscode-intro/" title="Visual Studio Code - Introduction" class="dd-item 
        
        
        
        ">
      <a href="https://goetzrieger.github.io/vscode-intro/">
          Visual Studio Code - Introduction
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://goetzrieger.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p></p>
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://schema.org/BreadcrumbList">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://goetzrieger.github.io/'></a> > <a href='https://goetzrieger.github.io/ansible-getting-started/'>Ansible Getting Started</a> > Running ad hoc commands
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#work-with-your-inventory">Work with your Inventory</a></li>
<li><a href="#the-ansible-configuration-files">The Ansible Configuration Files</a></li>
<li><a href="#ping-a-host">Ping a host</a></li>
<li><a href="#listing-modules-and-getting-help">Listing Modules and Getting Help</a></li>
<li><a href="#use-the-command-module">Use the command module</a></li>
<li><a href="#the-copy-module-and-permissions">The copy module and permissions</a></li>
<li><a href="#challenge-lab-modules">Challenge Lab: Modules</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Running ad hoc commands
            </h1>
          

        



	

<p>For our first exercise, we are going to run some ad hoc commands to help you get a feel for how Ansible works.  Ansible ad hoc commands enable you to perform tasks on remote nodes without having to write a playbook.  They are very useful when you simply need to do one or two things quickly and often, to many remote nodes.</p>

<h2 id="work-with-your-inventory">Work with your Inventory</h2>

<p>To use the ansible command for host management, you need to provide an inventory file which defines a list of hosts to be managed from the control node. In this lab the inventory is provided by your instructor. The inventory is an ini formatted file listing your hosts, sorted in groups, additionally providing some variables. Have a look for yourself, in your <strong>code-server terminal</strong> run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ cat lab_inventory/hosts

<span style="color:#f92672">[</span>all:vars<span style="color:#f92672">]</span>
ansible_user<span style="color:#f92672">=</span>student&lt;N&gt;
ansible_ssh_pass<span style="color:#f92672">=</span>&lt;password&gt;
ansible_port<span style="color:#f92672">=</span><span style="color:#ae81ff">22</span>

<span style="color:#f92672">[</span>web<span style="color:#f92672">]</span>
node1 ansible_host<span style="color:#f92672">=</span>&lt;IP address&gt;
node2 ansible_host<span style="color:#f92672">=</span>&lt;IP address&gt;
node3 ansible_host<span style="color:#f92672">=</span>&lt;IP address&gt;

<span style="color:#f92672">[</span>control<span style="color:#f92672">]</span>
ansible ansible_host<span style="color:#f92672">=</span>&lt;IP address&gt;</code></pre></div>

<div class="notices tip" ><p>The environment for this lab uses SSH with password authentication to login to the managed nodes. For the sake of keeping things simple the password is put into the inventory file in clear text. In real world scenarios you would either use SSH key authentication or supply the password in a secure way, e.g. by using Ansible Vault.</p>
</div>



<div class="notices tip" ><p>Note that each student has an individual lab environment so we left out the actual IPs and other data. As with the other cases, replace <strong>&lt;N&gt;</strong> with your actual student number.</p>
</div>


<p>Ansible is already configured to use the inventory specific to your environment, you&rsquo;ll learn how in a minute. For now let&rsquo;s execute some simple commands to work with the inventory.</p>

<p>To reference inventory hosts, you supply a host pattern to the ansible command. Ansible has a <code>--list-hosts</code> option which can be useful for clarifying which managed hosts are referenced by the host pattern in an ansible command.</p>

<p>The most basic host pattern is the name for a single managed host listed in the inventory file. This specifies that the host will be the only one in the inventory file that will be acted upon by the ansible command. Run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;X@&gt;ansible ~<span style="color:#f92672">]</span>$ ansible node1 --list-hosts
  hosts <span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>:
    node1</code></pre></div>
<p>An inventory file can contain a lot more information, it can organize your hosts in groups or define variables. In our example, the current inventory has the groups <code>web</code> and <code>control</code>. Run Ansible with these host patterns and observe the output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;X@&gt;ansible ~<span style="color:#f92672">]</span>$ ansible web --list-hosts
<span style="color:#f92672">[</span>student&lt;X@&gt;ansible ~<span style="color:#f92672">]</span>$ ansible web,ansible --list-hosts
<span style="color:#f92672">[</span>student&lt;X@&gt;ansible ~<span style="color:#f92672">]</span>$ ansible <span style="color:#e6db74">&#39;node*&#39;</span> --list-hosts
<span style="color:#f92672">[</span>student&lt;X@&gt;ansible ~<span style="color:#f92672">]</span>$ ansible all --list-hosts</code></pre></div>
<p>As you see it is OK to put systems in more than one group. For instance, a server could be both a web server and a database server. Note that in Ansible the groups are not necessarily hierarchical.</p>


<div class="notices tip" ><p>The inventory can contain more data. E.g. if you have hosts that run on non-standard SSH ports you can put the port number after the hostname with a colon. Or you could define names specific to Ansible and have them point to the &ldquo;real&rdquo; IP or hostname.</p>
</div>


<h2 id="the-ansible-configuration-files">The Ansible Configuration Files</h2>

<p>The behavior of Ansible can be customized by modifying settings in Ansible’s ini-style configuration file. Ansible will select its configuration file from one of several possible locations on the control node, please refer to the <a href="https://docs.ansible.com/ansible/latest/reference_appendices/config.html">documentation</a>.</p>


<div class="notices tip" ><p>The recommended practice is to create an <code>ansible.cfg</code> file in the directory from which you run Ansible commands. This directory would also contain any files used by your Ansible project, such as the inventory and playbooks. Another recommended practice is to create a file <code>.ansible.cfg</code> in your home directory.</p>
</div>


<p>In the lab environment provided to you an <code>.ansible.cfg</code> file has already been created and filled with the necessary details in the home directory of your <code>student&lt;N&gt;</code> user on the control node:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ls -la .ansible.cfg
-rw-r--r--. <span style="color:#ae81ff">1</span> student&lt;N&gt; student&lt;N&gt; <span style="color:#ae81ff">231</span> 14. Mai 17:17 .ansible.cfg</code></pre></div>
<p>Review the content of the file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ cat .ansible.cfg
<span style="color:#f92672">[</span>defaults<span style="color:#f92672">]</span>
stdout_callback <span style="color:#f92672">=</span> yaml
connection <span style="color:#f92672">=</span> smart
timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">60</span>
deprecation_warnings <span style="color:#f92672">=</span> False
host_key_checking <span style="color:#f92672">=</span> False
retry_files_enabled <span style="color:#f92672">=</span> False
inventory <span style="color:#f92672">=</span> /home/student&lt;N&gt;/lab_inventory/hosts</code></pre></div>
<p>There are multiple configuration flags provided. Most of them are not of interest here, but make sure to note the last line: there the location of the inventory is provided. That is the way Ansible knew in the previous commands what inventory to use to lookup the nodes.</p>

<h2 id="ping-a-host">Ping a host</h2>

<p>Let&rsquo;s start with something really basic - pinging a host. To do that we use the Ansible <code>ping</code> module. Basically, the <code>ping</code> module connects to the managed host, executes a small script there and collects the results. This ensures that the managed host is reachable and that Ansible is able to execute commands properly on it.</p>


<div class="notices tip" ><p>Think of a module as a tool which is designed to accomplish a specific task.</p>
</div>


<p>Ansible needs to know that it should use the <code>ping</code> module: The <code>-m</code> option defines which Ansible module to use. Options can be passed to the specified module using the <code>-a</code> option. In addition to the module Ansible needs to know what hosts it should run the task on, here you supply the group <code>web</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible web -m ping
node2 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;discovered_interpreter_python&#34;</span>: <span style="color:#e6db74">&#34;/usr/bin/python&#34;</span>
    <span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;changed&#34;</span>: false,
    <span style="color:#e6db74">&#34;ping&#34;</span>: <span style="color:#e6db74">&#34;pong&#34;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span></code></pre></div>
<p>As you see each node in the <code>web</code> group reports the successful execution and the actual result - here &ldquo;pong&rdquo;.</p>

<h2 id="listing-modules-and-getting-help">Listing Modules and Getting Help</h2>

<p>Ansible comes with a lot of modules by default. To list all modules run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible-doc -l</code></pre></div>

<div class="notices tip" ><p>In <code>ansible-doc</code> leave by pressing the button <code>q</code>. Use the <code>up</code>/<code>down</code> arrows to scroll through the content.</p>
</div>


<p>To find a module try e.g.:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible-doc -l | grep -i user</code></pre></div>
<p>Get help for a specific module including usage examples:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible-doc user</code></pre></div>

<div class="notices tip" ><p>Mandatory options are marked by a &ldquo;=&rdquo; in <code>ansible-doc</code>, optional ones by a &ldquo;-&rdquo;.</p>
</div>


<h2 id="use-the-command-module">Use the command module</h2>

<p>Now let&rsquo;s see how we can run a good ol&rsquo; fashioned Linux command and format the output using the <code>command</code> module. It simply executes the specified command on a managed host (note this time not a group but a hostname is used as host pattern):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible node1 -m command -a <span style="color:#e6db74">&#34;id&#34;</span>
node1 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
uid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>student1<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>student1<span style="color:#f92672">)</span> Gruppen<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>student1<span style="color:#f92672">)</span> Kontext<span style="color:#f92672">=</span>unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</code></pre></div>
<p>In this case the module is called <code>command</code> and the option passed with <code>-a</code> is the actual command to run. Try to run this ad hoc command on all managed hosts using the <code>all</code> host pattern.</p>

<p>Another example: Have a quick look at the kernel versions your hosts are running:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible all -m command -a <span style="color:#e6db74">&#39;uname -r&#39;</span></code></pre></div>
<p>Sometimes it’s desirable to have the output for a host on one line:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible all -m command -a <span style="color:#e6db74">&#39;uname -r&#39;</span> -o</code></pre></div>

<div class="notices tip" ><p>Like many Linux commands, <code>ansible</code> allows long-form options as well as short-form.  For example <code>ansible web --module-name ping</code> is the same as running <code>ansible web -m ping</code>.  We are going to be using the short-form options throughout this workshop.</p>
</div>


<h2 id="the-copy-module-and-permissions">The copy module and permissions</h2>

<p>Using the <code>copy</code> module, execute an ad hoc command on <code>node1</code> to change the contents of the <code>/etc/motd</code> file. <strong>The content is handed to the module through an option in this case</strong>.</p>

<p>Run the following, but <strong>expect an error</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible node1 -m copy -a <span style="color:#e6db74">&#39;content=&#34;Managed by Ansible\n&#34; dest=/etc/motd&#39;</span></code></pre></div>
<p>As mentioned this produces an <strong>error</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    node1 | FAILED! <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;changed&#34;</span>: false,
        <span style="color:#e6db74">&#34;checksum&#34;</span>: <span style="color:#e6db74">&#34;a314620457effe3a1db7e02eacd2b3fe8a8badca&#34;</span>,
        <span style="color:#e6db74">&#34;failed&#34;</span>: true,
        <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;Destination /etc not writable&#34;</span>
    <span style="color:#f92672">}</span></code></pre></div>
<p>The output of the ad hoc command is screaming <strong>FAILED</strong> in red at you. Why? Because user <strong>student&lt;N&gt;</strong> is not allowed to write the motd file.</p>

<p>Now this is a case for privilege escalation and the reason <code>sudo</code> has to be setup properly. We need to instruct Ansible to use <code>sudo</code> to run the command as root by using the parameter <code>-b</code> (think &ldquo;become&rdquo;).</p>


<div class="notices tip" ><p>Ansible will connect to the machines using your current user name (student&lt;N&gt; in this case), just like SSH would. To override the remote user name, you could use the <code>-u</code> parameter.</p>
</div>


<p>For us it’s okay to connect as <code>student&lt;N&gt;</code> because <code>sudo</code> is set up. Change the command to use the <code>-b</code> parameter and run again:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible node1 -m copy -a <span style="color:#e6db74">&#39;content=&#34;Managed by Ansible\n&#34; dest=/etc/motd&#39;</span> -b</code></pre></div>
<p>This time the command is a success:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">node1 | CHANGED <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;changed&#34;</span>: true,
    <span style="color:#e6db74">&#34;checksum&#34;</span>: <span style="color:#e6db74">&#34;4458b979ede3c332f8f2128385df4ba305e58c27&#34;</span>,
    <span style="color:#e6db74">&#34;dest&#34;</span>: <span style="color:#e6db74">&#34;/etc/motd&#34;</span>,
    <span style="color:#e6db74">&#34;gid&#34;</span>: 0,
    <span style="color:#e6db74">&#34;group&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>,
    <span style="color:#e6db74">&#34;md5sum&#34;</span>: <span style="color:#e6db74">&#34;65a4290ee5559756ad04e558b0e0c4e3&#34;</span>,
    <span style="color:#e6db74">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;0644&#34;</span>,
    <span style="color:#e6db74">&#34;owner&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>,
    <span style="color:#e6db74">&#34;secontext&#34;</span>: <span style="color:#e6db74">&#34;system_u:object_r:etc_t:s0&#34;</span>,
    <span style="color:#e6db74">&#34;size&#34;</span>: 19,
    <span style="color:#e6db74">&#34;src&#34;</span>: <span style="color:#e6db74">&#34;/home/student1/.ansible/tmp/ansible-tmp-1557857641.21-120920996103312/source&#34;</span>,
    <span style="color:#e6db74">&#34;state&#34;</span>: <span style="color:#e6db74">&#34;file&#34;</span>,
    <span style="color:#e6db74">&#34;uid&#34;</span>: <span style="color:#ae81ff">0</span></code></pre></div>
<p>Use Ansible with the generic <code>command</code> module to check the content of the motd file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student&lt;N&gt;@ansible-1 ~<span style="color:#f92672">]</span>$ ansible node1 -m command -a <span style="color:#e6db74">&#39;cat /etc/motd&#39;</span>
node1 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
Managed by Ansible</code></pre></div>
<p>Run the <code>ansible node1 -m copy …​</code> command from above again. Note:</p>

<ul>
<li>The different output color (proper terminal config provided).</li>
<li>The change from <code>&quot;changed&quot;: true,</code> to <code>&quot;changed&quot;: false,</code>.</li>
<li>The first line says <code>SUCCESS</code> instead of <code>CHANGED</code>.</li>
</ul>


<div class="notices tip" ><p>This makes it a lot easier to spot changes and what Ansible actually did.</p>
</div>


<h2 id="challenge-lab-modules">Challenge Lab: Modules</h2>

<ul>
<li><p>Using <code>ansible-doc</code></p>

<ul>
<li><p>Find a module that uses yum to manage software packages.</p></li>

<li><p>Look up the help examples for the module to learn how to install a package in the latest version.</p></li>
</ul></li>

<li><p>Run an Ansible ad hoc command to install the package &ldquo;vim&rdquo; in the latest version on all available nodes.</p></li>
</ul>


<div class="notices tip" ><p>Use the copy ad hoc command from above as a template and change the module and options.</p>
</div>


<details><summary>**>> Click here for Solution <<**</summary>
<p>
```bash
[student<N>@ansible-1 ~]$ ansible-doc -l | grep -i yum
[student<N>@ansible-1 ~]$ ansible-doc yum
[student<N>@ansible-1 ~]$ ansible all -m yum -a 'name=vim state=latest' -b
```
</p>
</details>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="https://goetzrieger.github.io/ansible-getting-started/1-setup/" title="Check the Prerequisites"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://goetzrieger.github.io/ansible-getting-started/3-playbook/" title="Writing Your First Playbook" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://goetzrieger.github.io/js/clipboard.min.js?1601306300"></script>
    <script src="https://goetzrieger.github.io/js/perfect-scrollbar.min.js?1601306300"></script>
    <script src="https://goetzrieger.github.io/js/perfect-scrollbar.jquery.min.js?1601306300"></script>
    <script src="https://goetzrieger.github.io/js/jquery.sticky.js?1601306300"></script>
    <script src="https://goetzrieger.github.io/js/featherlight.min.js?1601306300"></script>
    <script src="https://goetzrieger.github.io/js/highlight.pack.js?1601306300"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://goetzrieger.github.io/js/modernizr.custom-3.6.0.js?1601306300"></script>
    <script src="https://goetzrieger.github.io/js/learn.js?1601306300"></script>
    <script src="https://goetzrieger.github.io/js/hugo-learn.js?1601306300"></script>

    <link href="https://goetzrieger.github.io/mermaid/mermaid.css?1601306300" rel="stylesheet" />
    <script src="https://goetzrieger.github.io/mermaid/mermaid.js?1601306300"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
